{
    "resourceType": "StructureMap",
    "id": "emcareb.registration.e",
    "text": {
        "status": "generated",
        "div": "<div xmlns=\"http://www.w3.org/1999/xhtml\"><pre>map &quot;https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureMap/emcareb.registration.e&quot; = &quot;emcareb.registration.e&quot;\r\n\r\n\r\nuses &quot;http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaireresponse&quot; alias 'questionnaireResponse' as source\r\nuses &quot;http://hl7.org/fhir/StructureDefinition/Bundle&quot; alias 'Bundle' as target\r\nuses &quot;https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureDefinition/encounter&quot; alias 'Encounter' as target\r\nuses &quot;https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureDefinition/observation&quot; alias 'Observation' as target\r\nuses &quot;https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureDefinition/emcareencounter&quot; alias 'EmCare Encounter' as produced\r\nuses &quot;https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureDefinition/emcareobservation&quot; alias 'EmCare Observation' as produced\r\n\r\ngroup bundletrans(source src : questionnaireResponse, target bundle : Bundle) {\r\n  src -&gt; bundle.id = uuid() &quot;id&quot;;\r\n  src -&gt; bundle.type = 'batch' &quot;type&quot;;\r\n  src -&gt; bundle.entry as entry then {\r\n    src.encounter as encounter then {\r\n      encounter.id as idval -&gt;  entry.request as request,  request.method = 'PUT',  request.url = append('/Encounter/', idval) &quot;f7ed42d5&quot;;\r\n    } &quot;49f4ed45&quot;;\r\n    src -&gt; entry.resource = create('Encounter') as tgt then {\r\n      src -&gt; tgt then emcareencounter(src, tgt) &quot;fd415ba8&quot;;\r\n      src.subject as sub -&gt; tgt.subject = sub &quot;23252e10&quot;;\r\n    } &quot;aa65c498&quot;;\r\n  } &quot;put-emcareencounter&quot;;\r\n  src where src.item.where(linkId = 'EmCare.B3.DE05').exists() then {\r\n    src -&gt;  bundle.entry as entry,  entry.request as request,  request.method = 'POST',  entry.resource = create('Observation') as tgt then emcareobservationemcareb3de05(src, tgt) &quot;DE05&quot;;\r\n  } &quot;emcareobservation&quot;;\r\n}\r\n\r\ngroup emcareencounter(source src : questionnaireResponse, target tgt : Encounter) {\r\n  src.item as item where linkId = 'EmCare.A.DE07' then {\r\n    item.answer first as a then {\r\n      a.value as val -&gt;  tgt.period as period,  period.start = val &quot;aemcareade07&quot;;\r\n    } &quot;aemcareade07&quot;;\r\n  } &quot;emcareade07&quot;;\r\n  src.item as item where linkId = 'EmCare.B2.DE01' then {\r\n    item.answer first as a then {\r\n      a.value as val -&gt;  tgt.type = create('CodeableConcept') as CC,  CC.text = 'type of visit',  CC.coding = val &quot;aemcareb2de01&quot;;\r\n    } &quot;aemcareb2de01&quot;;\r\n  } &quot;emcareb2de01&quot;;\r\n  src.item as item where linkId = 'EmCare.B3.DE01' then {\r\n    item.answer first as a then {\r\n      a.value as val -&gt;  tgt.reasonCode = create('CodeableConcept') as CC,  CC.text = 'new consultation',  CC.coding = val &quot;aemcareb3de01&quot;;\r\n    } &quot;aemcareb3de01&quot;;\r\n  } &quot;emcareb3de01&quot;;\r\n  src.item as item where linkId = 'EmCare.B3.DE06' then {\r\n    item.answer first as a then {\r\n      a.value as val -&gt;  tgt.type = create('CodeableConcept') as CC,  CC.text = 'new consultation',  CC.coding = val &quot;aemcareb3de06&quot;;\r\n    } &quot;aemcareb3de06&quot;;\r\n  } &quot;emcareb3de06&quot;;\r\n  src.item as item where linkId = 'EmCare.B3.DE09' then {\r\n    item.answer first as a then {\r\n      a.value as val -&gt;  tgt.extension = create('Extension') as ext,  ext.url = 'https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureDefinition/refered',  ext.value = val &quot;aemcareb3de09&quot;;\r\n    } &quot;aemcareb3de09&quot;;\r\n  } &quot;emcareb3de09&quot;;\r\n}\r\n\r\ngroup getIdemcareencounter(source src, target tgt) {\r\n  src.item first as item where linkId = 'emcareencounterid' -&gt; tgt then {\r\n    item.answer first as a -&gt; tgt then {\r\n      a.value as val -&gt; tgt.id = val &quot;8e3eaf71&quot;;\r\n    } &quot;f3550c0d&quot;;\r\n  } &quot;269afe68&quot;;\r\n}\r\n\r\ngroup getFullUrlemcareencounter(source src, target tgt) {\r\n  src.item first as item where linkId = 'emcareencounterid' -&gt; tgt then {\r\n    item.answer first as a -&gt; tgt then {\r\n      a.value as val -&gt; tgt.fullUrl = append('urn:uuid:', val) &quot;a6735326&quot;;\r\n    } &quot;8a0f6df2&quot;;\r\n  } &quot;d383794d&quot;;\r\n}\r\n\r\ngroup getUrlemcareencounter(source src, target tgt) {\r\n  src.item first as item where linkId = 'emcareencounterid' -&gt; tgt then {\r\n    item.answer first as a -&gt; tgt then {\r\n      a.value as val -&gt; ref.reference = append('/Encounter/', val) &quot;e8494603&quot;;\r\n    } &quot;35ea1ad7&quot;;\r\n  } &quot;558d60eb&quot;;\r\n}\r\n\r\ngroup emcareobservationemcareb3de05(source src, target tgt) {\r\n  src -&gt;  tgt.identifier = create('Identifier') as CodeID,  CodeID.system = 'http://hl7.org/fhir/namingsystem-identifier-type',  CodeID.use = 'official',  CodeID.value = 'uuid',  CodeID.id = uuid() &quot;id-emcareb3de05&quot;;\r\n  src.encounter as encounter -&gt; tgt.encounter = encounter &quot;35bc6b82&quot;;\r\n  src.subject as subject -&gt;  tgt.subject = subject,  tgt.meta = create('Meta') as newMeta,  newMeta.profile = 'https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureDefinition/emcareobservation',  tgt.code = create('CodeableConcept') as concept,  concept.coding = create('Coding') as coding,  coding.system = 'https://fhir.dk.swisstph-mis.ch/matchbox/fhir/CodeSystem/emcare-custom-codes',  coding.code = 'EmCare.B3.DE05' &quot;code-emcareb3de05&quot;;\r\n  src.item as item where linkId = 'timestamp' then {\r\n    item.answer first as a then {\r\n      a.value as val -&gt; tgt.issued = val &quot;8945c96b&quot;;\r\n    } &quot;4272fc8b&quot;;\r\n  } &quot;f4472f32&quot;;\r\n  src.subject as subject -&gt; tgt.subject = subject &quot;patient&quot;;\r\n  src.item first as item where linkId = 'EmCare.B3.DE05' then {\r\n    item.answer first as a then {\r\n      a where a.value = 'yes' -&gt; tgt.status = 'final' &quot;final-emcareb3de05&quot;;\r\n      a where a.value = 'no' -&gt; tgt.status = 'cancelled' &quot;notfound-emcareb3de05&quot;;\r\n    } &quot;an-emcareb3de05&quot;;\r\n  } &quot;it-emcareb3de05&quot;;\r\n}\r\n\r\n</pre></div>"
    },
    "url": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureMap/emcareb.registration.e",
    "name": "emcareb.registration.e",
    "status": "active",
    "structure": [
        {
            "url": "http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaireresponse",
            "mode": "source",
            "alias": "'questionnaireResponse'"
        },
        {
            "url": "http://hl7.org/fhir/StructureDefinition/Bundle",
            "mode": "target",
            "alias": "'Bundle'"
        },
        {
            "url": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureDefinition/encounter",
            "mode": "target",
            "alias": "'Encounter'"
        },
        {
            "url": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureDefinition/observation",
            "mode": "target",
            "alias": "'Observation'"
        },
        {
            "url": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureDefinition/emcareencounter",
            "mode": "produced",
            "alias": "'EmCare Encounter'"
        },
        {
            "url": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureDefinition/emcareobservation",
            "mode": "produced",
            "alias": "'EmCare Observation'"
        }
    ],
    "group": [
        {
            "name": "bundletrans",
            "typeMode": "none",
            "input": [
                {
                    "name": "src",
                    "type": "questionnaireResponse",
                    "mode": "source"
                },
                {
                    "name": "bundle",
                    "type": "Bundle",
                    "mode": "target"
                }
            ],
            "rule": [
                {
                    "name": "id",
                    "source": [
                        {
                            "context": "src"
                        }
                    ],
                    "target": [
                        {
                            "context": "bundle",
                            "contextType": "variable",
                            "element": "id",
                            "transform": "uuid"
                        }
                    ]
                },
                {
                    "name": "type",
                    "source": [
                        {
                            "context": "src"
                        }
                    ],
                    "target": [
                        {
                            "context": "bundle",
                            "contextType": "variable",
                            "element": "type",
                            "transform": "copy",
                            "parameter": [
                                {
                                    "valueString": "batch"
                                }
                            ]
                        }
                    ]
                },
                {
                    "name": "put-emcareencounter",
                    "source": [
                        {
                            "context": "src"
                        }
                    ],
                    "target": [
                        {
                            "context": "bundle",
                            "contextType": "variable",
                            "element": "entry",
                            "variable": "entry"
                        }
                    ],
                    "rule": [
                        {
                            "name": "49f4ed45",
                            "source": [
                                {
                                    "context": "src",
                                    "element": "encounter",
                                    "variable": "encounter"
                                }
                            ],
                            "rule": [
                                {
                                    "name": "f7ed42d5",
                                    "source": [
                                        {
                                            "context": "encounter",
                                            "element": "id",
                                            "variable": "idval"
                                        }
                                    ],
                                    "target": [
                                        {
                                            "context": "entry",
                                            "contextType": "variable",
                                            "element": "request",
                                            "variable": "request"
                                        },
                                        {
                                            "context": "request",
                                            "contextType": "variable",
                                            "element": "method",
                                            "transform": "copy",
                                            "parameter": [
                                                {
                                                    "valueString": "PUT"
                                                }
                                            ]
                                        },
                                        {
                                            "context": "request",
                                            "contextType": "variable",
                                            "element": "url",
                                            "transform": "append",
                                            "parameter": [
                                                {
                                                    "valueString": "/Encounter/"
                                                },
                                                {
                                                    "valueId": "idval"
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            "name": "aa65c498",
                            "source": [
                                {
                                    "context": "src"
                                }
                            ],
                            "target": [
                                {
                                    "context": "entry",
                                    "contextType": "variable",
                                    "element": "resource",
                                    "variable": "tgt",
                                    "transform": "create",
                                    "parameter": [
                                        {
                                            "valueString": "Encounter"
                                        }
                                    ]
                                }
                            ],
                            "rule": [
                                {
                                    "name": "fd415ba8",
                                    "source": [
                                        {
                                            "context": "src"
                                        }
                                    ],
                                    "target": [
                                        {
                                            "contextType": "variable",
                                            "transform": "copy",
                                            "parameter": [
                                                {
                                                    "valueId": "tgt"
                                                }
                                            ]
                                        }
                                    ],
                                    "dependent": [
                                        {
                                            "name": "emcareencounter",
                                            "variable": [
                                                "src",
                                                "tgt"
                                            ]
                                        }
                                    ]
                                },
                                {
                                    "name": "23252e10",
                                    "source": [
                                        {
                                            "context": "src",
                                            "element": "subject",
                                            "variable": "sub"
                                        }
                                    ],
                                    "target": [
                                        {
                                            "context": "tgt",
                                            "contextType": "variable",
                                            "element": "subject",
                                            "transform": "copy",
                                            "parameter": [
                                                {
                                                    "valueId": "sub"
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                },
                {
                    "name": "emcareobservation",
                    "source": [
                        {
                            "context": "src",
                            "condition": "src.item.where(linkId = 'EmCare.B3.DE05').exists()"
                        }
                    ],
                    "rule": [
                        {
                            "name": "act-EmCare.B3.DE05",
                            "source": [
                                {
                                    "context": "src"
                                }
                            ],
                            "target": [
                                {
                                    "context": "bundle",
                                    "contextType": "variable",
                                    "element": "entry",
                                    "variable": "entry"
                                },
                                {
                                    "context": "entry",
                                    "contextType": "variable",
                                    "element": "request",
                                    "variable": "request"
                                },
                                {
                                    "context": "request",
                                    "contextType": "variable",
                                    "element": "method",
                                    "transform": "copy",
                                    "parameter": [
                                        {
                                            "valueString": "POST"
                                        }
                                    ]
                                },
                                {
                                    "context": "entry",
                                    "contextType": "variable",
                                    "element": "resource",
                                    "variable": "tgt",
                                    "transform": "create",
                                    "parameter": [
                                        {
                                            "valueString": "Observation"
                                        }
                                    ]
                                }
                            ],
                            "dependent": [
                                {
                                    "name": "emcareobservationemcareb3de05",
                                    "variable": [
                                        "src",
                                        "tgt"
                                    ]
                                }
                            ]
                        }
                    ]
                }
            ]
        },
        {
            "name": "emcareencounter",
            "typeMode": "none",
            "input": [
                {
                    "name": "src",
                    "type": "questionnaireResponse",
                    "mode": "source"
                },
                {
                    "name": "tgt",
                    "type": "Encounter",
                    "mode": "target"
                }
            ],
            "rule": [
                {
                    "name": "emcareade07",
                    "source": [
                        {
                            "context": "src",
                            "element": "item",
                            "variable": "item",
                            "condition": "linkId = 'EmCare.A.DE07'"
                        }
                    ],
                    "rule": [
                        {
                            "name": "aemcareade07",
                            "source": [
                                {
                                    "context": "item",
                                    "element": "answer",
                                    "listMode": "first",
                                    "variable": "a"
                                }
                            ],
                            "rule": [
                                {
                                    "name": "aemcareade07",
                                    "source": [
                                        {
                                            "context": "a",
                                            "element": "value",
                                            "variable": "val"
                                        }
                                    ],
                                    "target": [
                                        {
                                            "context": "tgt",
                                            "contextType": "variable",
                                            "element": "period",
                                            "variable": "period"
                                        },
                                        {
                                            "context": "period",
                                            "contextType": "variable",
                                            "element": "start",
                                            "transform": "copy",
                                            "parameter": [
                                                {
                                                    "valueId": "val"
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                },
                {
                    "name": "emcareb2de01",
                    "source": [
                        {
                            "context": "src",
                            "element": "item",
                            "variable": "item",
                            "condition": "linkId = 'EmCare.B2.DE01'"
                        }
                    ],
                    "rule": [
                        {
                            "name": "aemcareb2de01",
                            "source": [
                                {
                                    "context": "item",
                                    "element": "answer",
                                    "listMode": "first",
                                    "variable": "a"
                                }
                            ],
                            "rule": [
                                {
                                    "name": "aemcareb2de01",
                                    "source": [
                                        {
                                            "context": "a",
                                            "element": "value",
                                            "variable": "val"
                                        }
                                    ],
                                    "target": [
                                        {
                                            "context": "tgt",
                                            "contextType": "variable",
                                            "element": "type",
                                            "variable": "CC",
                                            "transform": "create",
                                            "parameter": [
                                                {
                                                    "valueString": "CodeableConcept"
                                                }
                                            ]
                                        },
                                        {
                                            "context": "CC",
                                            "contextType": "variable",
                                            "element": "text",
                                            "transform": "copy",
                                            "parameter": [
                                                {
                                                    "valueString": "type of visit"
                                                }
                                            ]
                                        },
                                        {
                                            "context": "CC",
                                            "contextType": "variable",
                                            "element": "coding",
                                            "transform": "copy",
                                            "parameter": [
                                                {
                                                    "valueId": "val"
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                },
                {
                    "name": "emcareb3de01",
                    "source": [
                        {
                            "context": "src",
                            "element": "item",
                            "variable": "item",
                            "condition": "linkId = 'EmCare.B3.DE01'"
                        }
                    ],
                    "rule": [
                        {
                            "name": "aemcareb3de01",
                            "source": [
                                {
                                    "context": "item",
                                    "element": "answer",
                                    "listMode": "first",
                                    "variable": "a"
                                }
                            ],
                            "rule": [
                                {
                                    "name": "aemcareb3de01",
                                    "source": [
                                        {
                                            "context": "a",
                                            "element": "value",
                                            "variable": "val"
                                        }
                                    ],
                                    "target": [
                                        {
                                            "context": "tgt",
                                            "contextType": "variable",
                                            "element": "reasonCode",
                                            "variable": "CC",
                                            "transform": "create",
                                            "parameter": [
                                                {
                                                    "valueString": "CodeableConcept"
                                                }
                                            ]
                                        },
                                        {
                                            "context": "CC",
                                            "contextType": "variable",
                                            "element": "text",
                                            "transform": "copy",
                                            "parameter": [
                                                {
                                                    "valueString": "new consultation"
                                                }
                                            ]
                                        },
                                        {
                                            "context": "CC",
                                            "contextType": "variable",
                                            "element": "coding",
                                            "transform": "copy",
                                            "parameter": [
                                                {
                                                    "valueId": "val"
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                },
                {
                    "name": "emcareb3de06",
                    "source": [
                        {
                            "context": "src",
                            "element": "item",
                            "variable": "item",
                            "condition": "linkId = 'EmCare.B3.DE06'"
                        }
                    ],
                    "rule": [
                        {
                            "name": "aemcareb3de06",
                            "source": [
                                {
                                    "context": "item",
                                    "element": "answer",
                                    "listMode": "first",
                                    "variable": "a"
                                }
                            ],
                            "rule": [
                                {
                                    "name": "aemcareb3de06",
                                    "source": [
                                        {
                                            "context": "a",
                                            "element": "value",
                                            "variable": "val"
                                        }
                                    ],
                                    "target": [
                                        {
                                            "context": "tgt",
                                            "contextType": "variable",
                                            "element": "type",
                                            "variable": "CC",
                                            "transform": "create",
                                            "parameter": [
                                                {
                                                    "valueString": "CodeableConcept"
                                                }
                                            ]
                                        },
                                        {
                                            "context": "CC",
                                            "contextType": "variable",
                                            "element": "text",
                                            "transform": "copy",
                                            "parameter": [
                                                {
                                                    "valueString": "new consultation"
                                                }
                                            ]
                                        },
                                        {
                                            "context": "CC",
                                            "contextType": "variable",
                                            "element": "coding",
                                            "transform": "copy",
                                            "parameter": [
                                                {
                                                    "valueId": "val"
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                },
                {
                    "name": "emcareb3de09",
                    "source": [
                        {
                            "context": "src",
                            "element": "item",
                            "variable": "item",
                            "condition": "linkId = 'EmCare.B3.DE09'"
                        }
                    ],
                    "rule": [
                        {
                            "name": "aemcareb3de09",
                            "source": [
                                {
                                    "context": "item",
                                    "element": "answer",
                                    "listMode": "first",
                                    "variable": "a"
                                }
                            ],
                            "rule": [
                                {
                                    "name": "aemcareb3de09",
                                    "source": [
                                        {
                                            "context": "a",
                                            "element": "value",
                                            "variable": "val"
                                        }
                                    ],
                                    "target": [
                                        {
                                            "context": "tgt",
                                            "contextType": "variable",
                                            "element": "extension",
                                            "variable": "ext",
                                            "transform": "create",
                                            "parameter": [
                                                {
                                                    "valueString": "Extension"
                                                }
                                            ]
                                        },
                                        {
                                            "context": "ext",
                                            "contextType": "variable",
                                            "element": "url",
                                            "transform": "copy",
                                            "parameter": [
                                                {
                                                    "valueString": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureDefinition/refered"
                                                }
                                            ]
                                        },
                                        {
                                            "context": "ext",
                                            "contextType": "variable",
                                            "element": "value",
                                            "transform": "copy",
                                            "parameter": [
                                                {
                                                    "valueId": "val"
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                }
            ]
        },
        {
            "name": "getIdemcareencounter",
            "typeMode": "none",
            "input": [
                {
                    "name": "src",
                    "mode": "source"
                },
                {
                    "name": "tgt",
                    "mode": "target"
                }
            ],
            "rule": [
                {
                    "name": "269afe68",
                    "source": [
                        {
                            "context": "src",
                            "element": "item",
                            "listMode": "first",
                            "variable": "item",
                            "condition": "linkId = 'emcareencounterid'"
                        }
                    ],
                    "target": [
                        {
                            "contextType": "variable",
                            "transform": "copy",
                            "parameter": [
                                {
                                    "valueId": "tgt"
                                }
                            ]
                        }
                    ],
                    "rule": [
                        {
                            "name": "f3550c0d",
                            "source": [
                                {
                                    "context": "item",
                                    "element": "answer",
                                    "listMode": "first",
                                    "variable": "a"
                                }
                            ],
                            "target": [
                                {
                                    "contextType": "variable",
                                    "transform": "copy",
                                    "parameter": [
                                        {
                                            "valueId": "tgt"
                                        }
                                    ]
                                }
                            ],
                            "rule": [
                                {
                                    "name": "8e3eaf71",
                                    "source": [
                                        {
                                            "context": "a",
                                            "element": "value",
                                            "variable": "val"
                                        }
                                    ],
                                    "target": [
                                        {
                                            "context": "tgt",
                                            "contextType": "variable",
                                            "element": "id",
                                            "transform": "copy",
                                            "parameter": [
                                                {
                                                    "valueId": "val"
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                }
            ]
        },
        {
            "name": "getFullUrlemcareencounter",
            "typeMode": "none",
            "input": [
                {
                    "name": "src",
                    "mode": "source"
                },
                {
                    "name": "tgt",
                    "mode": "target"
                }
            ],
            "rule": [
                {
                    "name": "d383794d",
                    "source": [
                        {
                            "context": "src",
                            "element": "item",
                            "listMode": "first",
                            "variable": "item",
                            "condition": "linkId = 'emcareencounterid'"
                        }
                    ],
                    "target": [
                        {
                            "contextType": "variable",
                            "transform": "copy",
                            "parameter": [
                                {
                                    "valueId": "tgt"
                                }
                            ]
                        }
                    ],
                    "rule": [
                        {
                            "name": "8a0f6df2",
                            "source": [
                                {
                                    "context": "item",
                                    "element": "answer",
                                    "listMode": "first",
                                    "variable": "a"
                                }
                            ],
                            "target": [
                                {
                                    "contextType": "variable",
                                    "transform": "copy",
                                    "parameter": [
                                        {
                                            "valueId": "tgt"
                                        }
                                    ]
                                }
                            ],
                            "rule": [
                                {
                                    "name": "a6735326",
                                    "source": [
                                        {
                                            "context": "a",
                                            "element": "value",
                                            "variable": "val"
                                        }
                                    ],
                                    "target": [
                                        {
                                            "context": "tgt",
                                            "contextType": "variable",
                                            "element": "fullUrl",
                                            "transform": "append",
                                            "parameter": [
                                                {
                                                    "valueString": "urn:uuid:"
                                                },
                                                {
                                                    "valueId": "val"
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                }
            ]
        },
        {
            "name": "getUrlemcareencounter",
            "typeMode": "none",
            "input": [
                {
                    "name": "src",
                    "mode": "source"
                },
                {
                    "name": "tgt",
                    "mode": "target"
                }
            ],
            "rule": [
                {
                    "name": "558d60eb",
                    "source": [
                        {
                            "context": "src",
                            "element": "item",
                            "listMode": "first",
                            "variable": "item",
                            "condition": "linkId = 'emcareencounterid'"
                        }
                    ],
                    "target": [
                        {
                            "contextType": "variable",
                            "transform": "copy",
                            "parameter": [
                                {
                                    "valueId": "tgt"
                                }
                            ]
                        }
                    ],
                    "rule": [
                        {
                            "name": "35ea1ad7",
                            "source": [
                                {
                                    "context": "item",
                                    "element": "answer",
                                    "listMode": "first",
                                    "variable": "a"
                                }
                            ],
                            "target": [
                                {
                                    "contextType": "variable",
                                    "transform": "copy",
                                    "parameter": [
                                        {
                                            "valueId": "tgt"
                                        }
                                    ]
                                }
                            ],
                            "rule": [
                                {
                                    "name": "e8494603",
                                    "source": [
                                        {
                                            "context": "a",
                                            "element": "value",
                                            "variable": "val"
                                        }
                                    ],
                                    "target": [
                                        {
                                            "context": "ref",
                                            "contextType": "variable",
                                            "element": "reference",
                                            "transform": "append",
                                            "parameter": [
                                                {
                                                    "valueString": "/Encounter/"
                                                },
                                                {
                                                    "valueId": "val"
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                }
            ]
        },
        {
            "name": "emcareobservationemcareb3de05",
            "typeMode": "none",
            "input": [
                {
                    "name": "src",
                    "mode": "source"
                },
                {
                    "name": "tgt",
                    "mode": "target"
                }
            ],
            "rule": [
                {
                    "name": "id-emcareb3de05",
                    "source": [
                        {
                            "context": "src"
                        }
                    ],
                    "target": [
                        {
                            "context": "tgt",
                            "contextType": "variable",
                            "element": "identifier",
                            "variable": "CodeID",
                            "transform": "create",
                            "parameter": [
                                {
                                    "valueString": "Identifier"
                                }
                            ]
                        },
                        {
                            "context": "CodeID",
                            "contextType": "variable",
                            "element": "system",
                            "transform": "copy",
                            "parameter": [
                                {
                                    "valueString": "http://hl7.org/fhir/namingsystem-identifier-type"
                                }
                            ]
                        },
                        {
                            "context": "CodeID",
                            "contextType": "variable",
                            "element": "use",
                            "transform": "copy",
                            "parameter": [
                                {
                                    "valueString": "official"
                                }
                            ]
                        },
                        {
                            "context": "CodeID",
                            "contextType": "variable",
                            "element": "value",
                            "transform": "copy",
                            "parameter": [
                                {
                                    "valueString": "uuid"
                                }
                            ]
                        },
                        {
                            "context": "CodeID",
                            "contextType": "variable",
                            "element": "id",
                            "transform": "uuid"
                        }
                    ]
                },
                {
                    "name": "35bc6b82",
                    "source": [
                        {
                            "context": "src",
                            "element": "encounter",
                            "variable": "encounter"
                        }
                    ],
                    "target": [
                        {
                            "context": "tgt",
                            "contextType": "variable",
                            "element": "encounter",
                            "transform": "copy",
                            "parameter": [
                                {
                                    "valueId": "encounter"
                                }
                            ]
                        }
                    ]
                },
                {
                    "name": "code-emcareb3de05",
                    "source": [
                        {
                            "context": "src",
                            "element": "subject",
                            "variable": "subject"
                        }
                    ],
                    "target": [
                        {
                            "context": "tgt",
                            "contextType": "variable",
                            "element": "subject",
                            "transform": "copy",
                            "parameter": [
                                {
                                    "valueId": "subject"
                                }
                            ]
                        },
                        {
                            "context": "tgt",
                            "contextType": "variable",
                            "element": "meta",
                            "variable": "newMeta",
                            "transform": "create",
                            "parameter": [
                                {
                                    "valueString": "Meta"
                                }
                            ]
                        },
                        {
                            "context": "newMeta",
                            "contextType": "variable",
                            "element": "profile",
                            "transform": "copy",
                            "parameter": [
                                {
                                    "valueString": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureDefinition/emcareobservation"
                                }
                            ]
                        },
                        {
                            "context": "tgt",
                            "contextType": "variable",
                            "element": "code",
                            "variable": "concept",
                            "transform": "create",
                            "parameter": [
                                {
                                    "valueString": "CodeableConcept"
                                }
                            ]
                        },
                        {
                            "context": "concept",
                            "contextType": "variable",
                            "element": "coding",
                            "variable": "coding",
                            "transform": "create",
                            "parameter": [
                                {
                                    "valueString": "Coding"
                                }
                            ]
                        },
                        {
                            "context": "coding",
                            "contextType": "variable",
                            "element": "system",
                            "transform": "copy",
                            "parameter": [
                                {
                                    "valueString": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir/CodeSystem/emcare-custom-codes"
                                }
                            ]
                        },
                        {
                            "context": "coding",
                            "contextType": "variable",
                            "element": "code",
                            "transform": "copy",
                            "parameter": [
                                {
                                    "valueString": "EmCare.B3.DE05"
                                }
                            ]
                        }
                    ]
                },
                {
                    "name": "f4472f32",
                    "source": [
                        {
                            "context": "src",
                            "element": "item",
                            "variable": "item",
                            "condition": "linkId = 'timestamp'"
                        }
                    ],
                    "rule": [
                        {
                            "name": "4272fc8b",
                            "source": [
                                {
                                    "context": "item",
                                    "element": "answer",
                                    "listMode": "first",
                                    "variable": "a"
                                }
                            ],
                            "rule": [
                                {
                                    "name": "8945c96b",
                                    "source": [
                                        {
                                            "context": "a",
                                            "element": "value",
                                            "variable": "val"
                                        }
                                    ],
                                    "target": [
                                        {
                                            "context": "tgt",
                                            "contextType": "variable",
                                            "element": "issued",
                                            "transform": "copy",
                                            "parameter": [
                                                {
                                                    "valueId": "val"
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                },
                {
                    "name": "patient",
                    "source": [
                        {
                            "context": "src",
                            "element": "subject",
                            "variable": "subject"
                        }
                    ],
                    "target": [
                        {
                            "context": "tgt",
                            "contextType": "variable",
                            "element": "subject",
                            "transform": "copy",
                            "parameter": [
                                {
                                    "valueId": "subject"
                                }
                            ]
                        }
                    ]
                },
                {
                    "name": "it-emcareb3de05",
                    "source": [
                        {
                            "context": "src",
                            "element": "item",
                            "listMode": "first",
                            "variable": "item",
                            "condition": "linkId = 'EmCare.B3.DE05'"
                        }
                    ],
                    "rule": [
                        {
                            "name": "an-emcareb3de05",
                            "source": [
                                {
                                    "context": "item",
                                    "element": "answer",
                                    "listMode": "first",
                                    "variable": "a"
                                }
                            ],
                            "rule": [
                                {
                                    "name": "final-emcareb3de05",
                                    "source": [
                                        {
                                            "context": "a",
                                            "condition": "a.value = 'yes'"
                                        }
                                    ],
                                    "target": [
                                        {
                                            "context": "tgt",
                                            "contextType": "variable",
                                            "element": "status",
                                            "transform": "copy",
                                            "parameter": [
                                                {
                                                    "valueString": "final"
                                                }
                                            ]
                                        }
                                    ]
                                },
                                {
                                    "name": "notfound-emcareb3de05",
                                    "source": [
                                        {
                                            "context": "a",
                                            "condition": "a.value = 'no'"
                                        }
                                    ],
                                    "target": [
                                        {
                                            "context": "tgt",
                                            "contextType": "variable",
                                            "element": "status",
                                            "transform": "copy",
                                            "parameter": [
                                                {
                                                    "valueString": "cancelled"
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                }
            ]
        }
    ]
}